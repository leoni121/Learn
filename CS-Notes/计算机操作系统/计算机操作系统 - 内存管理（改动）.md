[TOC]

# 虚拟内存

虚拟内存的目的是为了**让物理内存扩充成更大的逻辑内存**，从而**让程序获得更多的可用内存**，让用户感觉到内存比实际大。

> 操作系统将**内存抽象成地址空间**。程序拥有自己的地址空间，地址空间被分割成多个块，每一块称为一页。

从上面的描述中可以看出，**虚拟内存允许程序不用将地址空间中的每一页都映射到物理内存，也就是说一个程序不需要全部调入内存就可以运行，这使得有限的内存运行大程序成为可能**。

> 32KB 的物理内存，运行 64K 大小的程序。

# 页面置换算法

访问的页面不在内存中，就发生**缺页中断**从而将该**页调入**内存中。此时如果内存已**无空闲空间**，系统必须从内存中**调出一个页面到磁盘对换区中**来腾出空间。

页面置换算法的主要目标**是使页面置换频率最低（也可以说缺页率最低）**。

## 1. 最长时间内不再被访问

> OPT, Optimal replacement algorithm

所选择的被**换出的页面将是最长时间内不再被访问**，通常可以保证获得最低的缺页率。

是一种理论上的算法，因为**无法知道一个页面多长时间不再被访问**。

举例：一个系统为某进程分配了三个物理块，并有如下页面引用序列：

```html
7，0，1，2，0，3，0，4，2，3，0，3，2，1，2，0，1，7，0，1
```

开始运行时，先将 7, 0, 1 三个页面装入内存。当进程要访问页面 2 时，产生缺页中断，会将页面 7 换出，因为页面 7 再次被访问的时间最长。

## 2. 最近最久未使用

> LRU, Least Recently Used

虽然无法知道将来要使用的页面情况，但是可以知道过去使用页面的情况。**LRU 将最近最久未使用的页面换出**。

为了实现 LRU，需要在内存中**维护一个所有页面的链表。当一个页面被访问时，将这个页面移到链表表头。这样就能保证链表表尾的页面是最近最久未访问的。**

因为**每次访问都需要更新链表，因此这种方式实现的 LRU 代价很高。**

```html
4，7，0，7，1，0，1，2，1，2，6
```

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/eb859228-c0f2-4bce-910d-d9f76929352b.png"/> </div><br>
## 3. 先进先出

> FIFO, First In First Out

选择换出的页面是最先进入的页面。

该算法**会将那些经常被访问的页面也被换出，从而使缺页率升高**。
